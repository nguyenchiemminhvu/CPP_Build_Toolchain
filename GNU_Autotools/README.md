# Introduction

Before exploring Autotools, let's make sure we have a complete understanding of [GNU Make](https://github.com/nguyenchiemminhvu/CPP_Build_Toolchain/tree/master/GNU_Make).

In the tutorial about GNU Make above, there are some examples of Makefiles that are not too long or difficult to understand. Writing these Makefiles for small projects doesn't take much effort. However, when it comes to compiling large projects that need to run on different Unix-like systems, it becomes quite a challenge to write a Makefile that can meet these requirements. You might end up with a Makefile that spans thousands of lines and includes many macro definitions (-D) to accommodate various configurations.

```
#ifdef _WIN32
    #define OS_NAME "Windows"
#elif __APPLE__
    #define OS_NAME "Mac OS"
#elif __linux__
    #ifdef __ANDROID__
        #define OS_NAME "Android"
    #else
        #define OS_NAME "Linux"
    #endif
#elif __unix__
    #define OS_NAME "Unix-like"
#else
    #define OS_NAME "Unknown"
#endif

#ifdef __GNUC__
    #define COMPILER_NAME "GCC"
#elif _MSC_VER
    #define COMPILER_NAME "MSVC"
#elif __clang__
    #define COMPILER_NAME "Clang"
#else
    #define COMPILER_NAME "Unknown"
#endif

#ifdef __LP64__
    #define ARCHITECTURE "64-bit"
#else
    #define ARCHITECTURE "32-bit"
#endif
```

This is where GNU Autotools can be really helpful.

The GNU Autotools, also known as the GNU Build System, is a set of handy software packages including Autoconf, Automake, and Libtool used for building software on different types of Unix-like operating systems (POSIX-like).

- Autoconf helps create portable scripts to configure source code packages using templates and an M4 macro package.
- Automake helps create portable GNU standards-compiant Makefiles from template files, supporting all the targets documented by the [GNU Coding Standards](https://www.gnu.org/prep/standards/standards.html).
- Libtool helps create and use shared libraries portably.

Although Autoconf, Automake, and Libtool are three different tools that were developed independently, they can be combined together to form a toolchain. (A toolchain refers to the concept where the output of one tool becomes the input of another tool)

Look at the below diagram to see how these tools work together:

![GNU Autotools process](https://github.com/nguyenchiemminhvu/CPP_Build_Toolchain/blob/master/GNU_Autotools/GNU_Autotools_process.png?raw=true)

At the end, developers using GNU Autotools only need to care about the manual input files 'configure.ac' and 'Makefile.am'.

# Build HelloWorld project

The first thing we need before doing some stuff with Autotools is having a compilable source code repository. I prepare a simple one: [GNU_Autotools/SampleProjects/01_HelloWorld](https://github.com/nguyenchiemminhvu/CPP_Build_Toolchain/tree/master/GNU_Autotools/SampleProjects/01_HelloWorld)

## Write configure.ac for Autoconf

The configure.ac file is the key of a project's configuration. It contains various settings and instructions for Autoconf to generate the necessary files for building a project.

Write 'configure.ac' file might be quite complex at first sight. But for a simple C++ program like this HelloWorld, there are only a few configurations need to be set.

The programming language used for 'configure.ac' file is called Autoconf language. Autoconf is different from other programming languages because it treats code and plain text in the same way.

```AC_INIT``` specifies the name, version, and contact information for the project.

```AM_INIT_AUTOMAKE([OPTIONS])``` runs many macros required for proper operation of the generated Makefiles. Here are a few commonly used arguments:
```
AM_INIT_AUTOMAKE([-Wall foreign subdir-objects])
```

```AC_PROG_CXX``` checks for the presence of a C++ compiler. It ensures that the necessary tools are available for compiling your C++ code.

```AC_CONFIG_FILES``` specifies the files that need to be generated by Autoconf. In this case, we only need to generate the Makefile based on the Makefile.in template.

```AC_OUTPUT``` Every Autoconf script, e.g., configure.ac, should finish by calling AC_OUTPUT. That is the macro that generates and runs config.status, which in turn creates the makefiles and any other files resulting from configuration.

```
AC_INIT([HelloWorld], [1.0], [nguyenchiemminhvu@gmail.com])
AM_INIT_AUTOMAKE
AC_PROG_CXX
AC_CONFIG_FILES([Makefile])
AC_OUTPUT
```

The configure.ac file must be presented at the project's root directory.

## Write Makefile.am for Automake

Makefile.am file has the same format and syntax as a Makefile. If you went through the tutorial about [GNU Make](https://github.com/nguyenchiemminhvu/CPP_Build_Toolchain/tree/master/GNU_Make) and write a Makefile from scratch by yourself, things will be familiar. Often, we only need to define some variables in Makefile.am to indicate that what files will be built, where they will be intalled.

```bin_PROGRAMS``` specifies the name of the binary that will be generated during the build process. For example:

```
bin_PROGRAMS = helloworld
```

In this example, the binary name output of the build process is 'helloworld'. This binary name will be used as prefix of the following variables:

```<bin_name>_SOURCES``` Specifies the source files that will be compiled to object files.

```<bin_name>_CPPFLAGS``` Specifies any additional preprocessor flags that are required during the compilation process. Same as CPPFLAGS variable in GNU Make.

```<bin_name>_CXXFLAGS``` Specifies any additional compiler flags that are specific to C++. Same as CXXFLAGS variable in GNU Make.

```<bin_name>_LDFLAGS``` Specifies any additional linker flags that are needed during the linking process. Same as LDFLAGS variable in GNU Make.

```<bin_name>_LDADD``` Specifies any additional static libraries or object files that need to be linked with the binary.

```
bin_PROGRAMS = helloworld
helloworld_SOURCES = main.cpp

helloworld_CPPFLAGS = 
helloworld_CXXFLAGS = 
helloworld_LDFLAGS = 
helloworld_LDADD = 
```

## Start Building

After preparing the 'configure.ac' and 'Makefile.am' files, everything is ready for Autotools build process.

### Step By Step

```
ncmv@localhost:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/01_HelloWorld$ pwd
/home/ncmv/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/01_HelloWorld
ncmv@localhost:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/01_HelloWorld$ ls
configure.ac  main.cpp  Makefile.am
```

By running 'aclocal' command, a file aclocal.m4 is generated.

```
ncmv@localhost:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/01_HelloWorld$ aclocal
ncmv@localhost:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/01_HelloWorld$ ls
aclocal.m4  autom4te.cache  configure.ac  main.cpp  Makefile.am
```

The purpose of 'aclocal' is to consolidate different macro files from Autotool packages and user-specified locations into one file. This file, 'aclocal.m4', contains all the necessary macros that Autoconf needs to configure the project.

![](https://github.com/nguyenchiemminhvu/CPP_Build_Toolchain/blob/master/GNU_Autotools/aclocal_m4.png?raw=true)

With both input files 'configure.ac' and 'aclocal.m4', Autoconf has enough information about the build environment and project's dependencies to generate a 'configure' script. 

```
ncmv@localhost:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/01_HelloWorld$ autoconf 
ncmv@localhost:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/01_HelloWorld$ ls
aclocal.m4  autom4te.cache  configure  configure.ac  main.cpp  Makefile.am
```

The 'configure' script is important in Autotools because it is responsible for detecting the required libraries, and determine platform-specific details... to setup the necessary variables and options for the generated Makefile. The generated Makefile then adapts to the running platform and operating system.

For the next step, we run ```automake --add-missing``` command to build a 'Makefile.in' file from 'Makefile.am'.

```
ncmv@localhost:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/01_HelloWorld$ automake --add-missing 
configure.ac:2: installing './install-sh'
configure.ac:2: installing './missing'
Makefile.am: error: required file './AUTHORS' not found
Makefile.am: error: required file './ChangeLog' not found
Makefile.am: installing './INSTALL'
Makefile.am: error: required file './NEWS' not found
Makefile.am: error: required file './README' not found
Makefile.am: installing './COPYING' using GNU General Public License v3 file
Makefile.am:     Consider adding the COPYING file to the version control system
Makefile.am:     for your code, to avoid questions about which license your project uses
Makefile.am: installing './depcomp'
```

What's wrong with it? The error indicates that there are some required files for the project folder: AUTHORS, ChangeLog, NEWS, and README. This is one of the specific expectations made up the GNU build standard. Not a big deal, let us create these files in the root directory of project folder. We can even left them empty files, but it is a good practice to fill some basic information in the change logs.

```
ncmv@localhost:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/01_HelloWorld$ ls
aclocal.m4  AUTHORS  autom4te.cache  ChangeLog  configure  configure.ac  main.cpp  Makefile.am  NEWS  README
ncmv@localhost:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/01_HelloWorld$ cat AUTHORS 
NCMV <nguyenchiemminhvu@gmail.com>
ncmv@localhost:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/01_HelloWorld$ cat ChangeLog 
2024-05-12  NCMV  <nguyenchiemminhvu@gmail.com>
    * Initial commit
```

Now, continue at where we failed.

```
ncmv@localhost:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/01_HelloWorld$ automake --add-missing 
configure.ac:2: installing './install-sh'
configure.ac:2: installing './missing'
Makefile.am: installing './INSTALL'
Makefile.am: installing './COPYING' using GNU General Public License v3 file
Makefile.am:     Consider adding the COPYING file to the version control system
Makefile.am:     for your code, to avoid questions about which license your project uses
Makefile.am: installing './depcomp'
ncmv@localhost:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/01_HelloWorld$ ls
aclocal.m4  AUTHORS  autom4te.cache  ChangeLog  configure  configure.ac  COPYING  depcomp  INSTALL  install-sh  main.cpp  Makefile.am  Makefile.in  missing  NEWS  README
```

The '--add-missing' option tells 'automake' to automatically generate all of additional files required. It is useful when we start a new project or if we have recently cleaned up our project directory and accidentally removed some of these auxiliary files.

Now, Makefile.in file is created for the intput of 'configure' script. Just one more step, we gonna have our final Makefile.

```
ncmv@localhost:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/01_HelloWorld$ ./configure 
checking for a BSD-compatible install... /usr/bin/install -c
checking whether build environment is sane... yes
checking for a race-free mkdir -p... /usr/bin/mkdir -p
checking for gawk... gawk
checking whether make sets $(MAKE)... yes
checking whether make supports nested variables... yes
checking for g++... g++
checking whether the C++ compiler works... yes
checking for C++ compiler default output file name... a.out
checking for suffix of executables... 
checking whether we are cross compiling... no
checking for suffix of object files... o
checking whether the compiler supports GNU C++... yes
checking whether g++ accepts -g... yes
checking for g++ option to enable C++11 features... none needed
checking whether make supports the include directive... yes (GNU style)
checking dependency style of g++... gcc3
checking that generated files are newer than configure... done
configure: creating ./config.status
config.status: creating Makefile
config.status: executing depfiles commands

ncmv@localhost:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/01_HelloWorld$ ls
aclocal.m4  autom4te.cache  config.log     configure     COPYING  INSTALL     main.cpp  Makefile.am  missing  README
AUTHORS     ChangeLog       config.status  configure.ac  depcomp  install-sh  Makefile  Makefile.in  NEWS
```

The 'configure' script tests system features and set the appropriate variables in the generated Makefile. For example, the result above shows us GNU GCC compiler for C++ programming language is available:

```
checking for g++... g++
checking whether the C++ compiler works... yes
```

Then, Autotools can choose the g++ compiler for our C++ program:

```
ncmv@localhost:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/01_HelloWorld$ cat Makefile | grep g++
CXX = g++
ac_ct_CXX = g++
```

Or because our C++ program is quite simple, not using any C++11 features. So, configure script tells that:

```
checking for g++ option to enable C++11 features... none needed
```

As a result, the option '-std=c++11' is not found in the generated Makefile.

At last, simply run the 'make' command to build our C++ program.

```
ncmv@localhost:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/01_HelloWorld$ make
g++ -DPACKAGE_NAME=\"HelloWorld\" -DPACKAGE_TARNAME=\"helloworld\" -DPACKAGE_VERSION=\"1.0\" -DPACKAGE_STRING=\"HelloWorld\ 1.0\" -DPACKAGE_BUGREPORT=\"nguyenchiemminhvu@gmail.com\" -DPACKAGE_URL=\"\" -DPACKAGE=\"helloworld\" -DVERSION=\"1.0\" -I.     -g -O2 -MT main.o -MD -MP -MF .deps/main.Tpo -c -o main.o main.cpp
mv -f .deps/main.Tpo .deps/main.Po
g++  -g -O2   -o helloworld main.o  

ncmv@localhost:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/01_HelloWorld$ ./helloworld 
Hello World
```

### Simplified with Autoreconf

With the help of Autoreconf, the build process is even more simplified. Autoreconf knows how to prepare the necessary scripts and files needed to generate the Makefile correctly. It performs three important tasks: aclocal, autoconf, and automake.

![GNU Autotools process improved with autoreconf](https://github.com/nguyenchiemminhvu/CPP_Build_Toolchain/blob/master/GNU_Autotools/GNU_Autotools_process_improved.png?raw=true)

```
ncmv@localhost:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/01_HelloWorld$ pwd
/home/ncmv/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/01_HelloWorld
ncmv@localhost:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/01_HelloWorld$ ls
AUTHORS  ChangeLog  configure.ac  main.cpp  Makefile.am  NEWS  README
```

```
ncmv@localhost:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/01_HelloWorld$ autoreconf -i
configure.ac:2: installing './install-sh'
configure.ac:2: installing './missing'
Makefile.am: installing './INSTALL'
Makefile.am: installing './COPYING' using GNU General Public License v3 file
Makefile.am:     Consider adding the COPYING file to the version control system
Makefile.am:     for your code, to avoid questions about which license your project uses
Makefile.am: installing './depcomp'

ncmv@localhost:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/01_HelloWorld$ ls
aclocal.m4  AUTHORS  autom4te.cache  ChangeLog  configure  configure.ac  COPYING  depcomp  INSTALL  install-sh  main.cpp  Makefile.am  Makefile.in  missing  NEWS  README
```

```
ncmv@localhost:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/01_HelloWorld$ ./configure 
checking for a BSD-compatible install... /usr/bin/install -c
checking whether build environment is sane... yes
checking for a race-free mkdir -p... /usr/bin/mkdir -p
checking for gawk... gawk
checking whether make sets $(MAKE)... yes
checking whether make supports nested variables... yes
checking for g++... g++
checking whether the C++ compiler works... yes
checking for C++ compiler default output file name... a.out
checking for suffix of executables... 
checking whether we are cross compiling... no
checking for suffix of object files... o
checking whether the compiler supports GNU C++... yes
checking whether g++ accepts -g... yes
checking for g++ option to enable C++11 features... none needed
checking whether make supports the include directive... yes (GNU style)
checking dependency style of g++... gcc3
checking that generated files are newer than configure... done
configure: creating ./config.status
config.status: creating Makefile
config.status: executing depfiles commands

ncmv@localhost:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/01_HelloWorld$ ls
aclocal.m4  autom4te.cache  config.log     configure     COPYING  INSTALL     main.cpp  Makefile.am  missing  README
AUTHORS     ChangeLog       config.status  configure.ac  depcomp  install-sh  Makefile  Makefile.in  NEWS
```

```
ncmv@localhost:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/01_HelloWorld$ make
g++ -DPACKAGE_NAME=\"HelloWorld\" -DPACKAGE_TARNAME=\"helloworld\" -DPACKAGE_VERSION=\"1.0\" -DPACKAGE_STRING=\"HelloWorld\ 1.0\" -DPACKAGE_BUGREPORT=\"nguyenchiemminhvu@gmail.com\" -DPACKAGE_URL=\"\" -DPACKAGE=\"helloworld\" -DVERSION=\"1.0\" -I.     -g -O2 -MT main.o -MD -MP -MF .deps/main.Tpo -c -o main.o main.cpp
mv -f .deps/main.Tpo .deps/main.Po
g++  -g -O2   -o helloworld main.o  

ncmv@localhost:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/01_HelloWorld$ ./helloworld 
Hello World
```

By using 'autoreconf', we achieve the same result, but less steps to run. It reduces our manual efforts.

# Build a Library

In this section, we would practice to build a library and expect to have a shared object as output.
[GNU_Autotools/SampleProjects/02_jsoncpp_lib](https://github.com/nguyenchiemminhvu/CPP_Build_Toolchain/tree/master/GNU_Autotools/SampleProjects/02_jsoncpp_lib)

In this library project, the directory structure is organized in a way that aligns with the structure typically seen in C/C++ projects using Autotools.

```
sample_project
│   ├── AUTHORS
│   ├── ChangeLog
│   ├── configure.ac
│   ├── include
│   │   └── header files
│   ├── Makefile.am
│   ├── NEWS
│   ├── README
│   └── src
│       └── c/cpp files
```

The 'src' subdirectory is where we will find all the source code files that need to be compiled into object files. These source code files contain the actual implementation of the library.

The 'include' subdirectory is designated to hold the header files. These header files define the interfaces and declarations needed to use the library's functionality.

Additionally, we will find a configure.ac file, which is used by the autoconf tool. This file contains instructions and checks for configuring the build environment and generating the necessary build scripts.

The Makefile.am file is used by automake and specifies how to compile and link the source files into the final library.

In addition to these key files, we may also come across other Autotools-related files such as AUTHORS, ChangeLog, NEWS, and README. These files provide information about the project's authors, changelog, news updates, and general documentation respectively.

This directory structure and the associated Autotools files work together to provide a standardized and automated way to build, configure, and distribute the library.

```
├── AUTHORS
├── ChangeLog
├── configure.ac
├── include
│   └── json
│       ├── allocator.h
│       ├── assertions.h
│       ├── config.h
│       ├── forwards.h
│       ├── json_features.h
│       ├── json.h
│       ├── reader.h
│       ├── value.h
│       ├── version.h
│       └── writer.h
├── Makefile.am
├── NEWS
├── README
└── src
    ├── json_reader.cpp
    ├── json_tool.h
    ├── json_value.cpp
    ├── json_valueiterator.inl
    └── json_writer.cpp
```

Except for the source codes in include and src subdirectories are already there, copied from an opensource project, the preparation is the same. All we need are a 'configure.ac' file for ```autoconf``` and a 'Makefile.am' file ```automake```.

## Write configure.ac for Autoconf

Here is the sample configure.ac file for the configuration:

```
AC_INIT([libjsoncpp], [1.0], [nguyenchiemminhvu@gmail.com])
AM_INIT_AUTOMAKE([-Wall -Werror foreign])
AC_PROG_CXX
AC_CONFIG_FILES([Makefile])
AC_CONFIG_MACRO_DIRS([m4])
AM_PROG_AR
AC_PROG_RANLIB
AC_OUTPUT
```

In this modification compared to the configure.ac file in previous section [Build HelloWorld project](#build-helloworld-project), we have a few more configurations:

```AC_CONFIG_MACRO_DIRS([m4])``` specifies the directory where custom macro files are located.

```AM_PROG_AR``` checks for the presence of the 'ar' command, which is used to create and manipulate static libraries.

```AC_PROG_RANLIB``` checks for the presence of the 'ranlib' command, which is used to generate an index for a static library.

Don't worry when you can't remember these flags and variables at all time, autoconf and automake will tell us which options or variables to be declared in configure.ac and Makefile.am clearly if it needed. The build process would stop with error logs. For example:

```
worker@bb690a873660:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/02_jsoncpp_lib$ autoreconf -i
Makefile.am:1: error: library used but 'RANLIB' is undefined
Makefile.am:1:   The usual way to define 'RANLIB' is to add 'AC_PROG_RANLIB'
Makefile.am:1:   to 'configure.ac' and run 'autoconf' again.
automake: warnings are treated as errors
/usr/share/automake-1.15/am/library.am: warning: 'libjsoncpp.a': linking libraries using a non-POSIX
/usr/share/automake-1.15/am/library.am: archiver requires 'AM_PROG_AR' in 'configure.ac'
```

## Write Makefile.am for Automake

Here is the sample Makefile.am prepared for the Makefile generation:

```
lib_LIBRARIES = libjsoncpp.a
libjsoncpp_a_SOURCES = src/json_reader.cpp \
                       src/json_value.cpp \
                       src/json_writer.cpp
libjsoncpp_a_CPPFLAGS = -I$(top_srcdir)/include

AUTOMAKE_OPTIONS = subdir-objects

ACLOCAL_AMFLAGS = -I m4
```

When our target is a library file, 'lib_LIBRARIES' variable is used to specify the library name. This library name is also used as prefix of the common variables we have learned in previous section.

The library JSONCPP consists of three source files: json_reader.cpp, json_value.cpp, and json_writer.cpp, which are located in the src directory. We loaded them all to the '<lib_name>_SOURCES' variable, make sure that they are all compiled to the object files.

To ensure that the compiler can find the necessary header files, the -I flag is used with the path to the include directory in the top source directory.

The AUTOMAKE_OPTIONS is set to 'subdir-objects', which enables the generation of object files in subdirectories. This helps organize the build process. For instance, with 'subdir-objects' enabled, 'sub/dir/file.c' will be compiled to 'sub/dir/file.o' (or 'sub/dir/file.lo' if using Libtool) accordingly.

The 'ACLOCAL_AMFLAGS' is set to -I m4, which specifies the directory where aclocal should look for additional macros. The m4 directory is typically used to store custom Autoconf macros.

## Start Building

```
worker@bb690a873660:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/02_jsoncpp_lib$ autoreconf -i
aclocal: warning: couldn't open directory 'm4': No such file or directory
configure.ac:6: installing './ar-lib'
configure.ac:6: installing './compile'
configure.ac:2: installing './install-sh'
configure.ac:2: installing './missing'
Makefile.am: installing './depcomp'

worker@bb690a873660:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/02_jsoncpp_lib$ ./configure 
checking for a BSD-compatible install... /usr/bin/install -c
checking whether build environment is sane... yes
checking for a thread-safe mkdir -p... /bin/mkdir -p
checking for gawk... gawk
checking whether make sets $(MAKE)... yes
checking whether make supports nested variables... yes
checking for g++... g++
checking whether the C++ compiler works... yes
checking for C++ compiler default output file name... a.out
checking for suffix of executables... 
checking whether we are cross compiling... no
checking for suffix of object files... o
checking whether we are using the GNU C++ compiler... yes
checking whether g++ accepts -g... yes
checking for style of include used by make... GNU
checking dependency style of g++... gcc3
checking for gcc... gcc
checking whether we are using the GNU C compiler... yes
checking whether gcc accepts -g... yes
checking for gcc option to accept ISO C89... none needed
checking whether gcc understands -c and -o together... yes
checking dependency style of gcc... gcc3
checking for ar... ar
checking the archiver (ar) interface... ar
checking for ranlib... ranlib
checking that generated files are newer than configure... done
configure: creating ./config.status
config.status: creating Makefile
config.status: executing depfiles commands

worker@bb690a873660:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/02_jsoncpp_lib$ make
g++ -DPACKAGE_NAME=\"libjsoncpp\" -DPACKAGE_TARNAME=\"libjsoncpp\" -DPACKAGE_VERSION=\"1.0\" -DPACKAGE_STRING=\"libjsoncpp\ 1.0\" -DPACKAGE_BUGREPORT=\"nguyenchiemminhvu@gmail.com\" -DPACKAGE_URL=\"\" -DPACKAGE=\"libjsoncpp\" -DVERSION=\"1.0\" -I.  -I./include -fPIC -shared   -g -O2 -MT src/libjsoncpp_a-json_reader.o -MD -MP -MF src/.deps/libjsoncpp_a-json_reader.Tpo -c -o src/libjsoncpp_a-json_reader.o `test -f 'src/json_reader.cpp' || echo './'`src/json_reader.cpp
mv -f src/.deps/libjsoncpp_a-json_reader.Tpo src/.deps/libjsoncpp_a-json_reader.Po
g++ -DPACKAGE_NAME=\"libjsoncpp\" -DPACKAGE_TARNAME=\"libjsoncpp\" -DPACKAGE_VERSION=\"1.0\" -DPACKAGE_STRING=\"libjsoncpp\ 1.0\" -DPACKAGE_BUGREPORT=\"nguyenchiemminhvu@gmail.com\" -DPACKAGE_URL=\"\" -DPACKAGE=\"libjsoncpp\" -DVERSION=\"1.0\" -I.  -I./include -fPIC -shared   -g -O2 -MT src/libjsoncpp_a-json_value.o -MD -MP -MF src/.deps/libjsoncpp_a-json_value.Tpo -c -o src/libjsoncpp_a-json_value.o `test -f 'src/json_value.cpp' || echo './'`src/json_value.cpp
mv -f src/.deps/libjsoncpp_a-json_value.Tpo src/.deps/libjsoncpp_a-json_value.Po
g++ -DPACKAGE_NAME=\"libjsoncpp\" -DPACKAGE_TARNAME=\"libjsoncpp\" -DPACKAGE_VERSION=\"1.0\" -DPACKAGE_STRING=\"libjsoncpp\ 1.0\" -DPACKAGE_BUGREPORT=\"nguyenchiemminhvu@gmail.com\" -DPACKAGE_URL=\"\" -DPACKAGE=\"libjsoncpp\" -DVERSION=\"1.0\" -I.  -I./include -fPIC -shared   -g -O2 -MT src/libjsoncpp_a-json_writer.o -MD -MP -MF src/.deps/libjsoncpp_a-json_writer.Tpo -c -o src/libjsoncpp_a-json_writer.o `test -f 'src/json_writer.cpp' || echo './'`src/json_writer.cpp
mv -f src/.deps/libjsoncpp_a-json_writer.Tpo src/.deps/libjsoncpp_a-json_writer.Po
rm -f libjsoncpp.a
ar cru libjsoncpp.a src/libjsoncpp_a-json_reader.o src/libjsoncpp_a-json_value.o src/libjsoncpp_a-json_writer.o 
ar: `u' modifier ignored since `D' is the default (see `U')
ranlib libjsoncpp.a

worker@bb690a873660:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/02_jsoncpp_lib$ find . | grep libjson
./libjsoncpp.a
./src/libjsoncpp_a-json_value.o
./src/libjsoncpp_a-json_writer.o
./src/libjsoncpp_a-json_reader.o
./src/.deps/libjsoncpp_a-json_writer.Po
./src/.deps/libjsoncpp_a-json_reader.Po
./src/.deps/libjsoncpp_a-json_value.Po
```

There is something not matched with our expectation. We expect to have a shared object (.so) file, but it finally give us a static library (.a) file.

## Utilize Libtool to Build Dynamic Library

To build a shared object library (.so) instead of a static library (.a), we need Libtool.

### configure.ac that utilize the Libtool

```
AC_INIT([libjsoncpp], [1.0], [nguyenchiemminhvu@gmail.com])
AM_INIT_AUTOMAKE([-Wall -Werror foreign])
AC_PROG_CXX
AC_CONFIG_FILES([Makefile])
AC_CONFIG_MACRO_DIRS([m4])
LT_INIT
AC_OUTPUT
```

In this configure.ac file, since we don't need to use 'ranlib' command for static library, 'AC_PROG_RANLIB' can be removed. Instead, we add the 'LT_INIT' marco to initialize the Libtool support.

### Makefile.am that utilize the Libtool

```
lib_LIBRARIES = libjsoncpp.a
libjsoncpp_a_SOURCES = src/json_reader.cpp \
                       src/json_value.cpp \
                       src/json_writer.cpp
libjsoncpp_a_CPPFLAGS = -I$(top_srcdir)/include \
                        -fPIC
libjsoncpp_a_LDFLAGS = -shared

lib_LTLIBRARIES = libjsoncpp.la
libjsoncpp_la_SOURCES = $(libjsoncpp_a_SOURCES)
libjsoncpp_la_CPPFLAGS = $(libjsoncpp_a_CPPFLAGS)
libjsoncpp_la_LDFLAGS = $(libjsoncpp_a_LDFLAGS) -version-info 0:0:0

AUTOMAKE_OPTIONS = subdir-objects
ACLOCAL_AMFLAGS = -I m4
```

In this modified version, we use the lib_LTLIBRARIES variable instead of lib_LIBRARIES. The lib_LTLIBRARIES variable is used to specify the creation of shared object libraries.

We also change the suffix of the library file from .a to .la to indicate that it's a library managed by Libtool.

The libjsoncpp_la_CPPFLAGS variable has an additional option '-fPIC' that tells the compiler to generate position-independent code, ensure that the library can be loaded and executed at different memory locations by multiple processes simulataneously.

The libjsoncpp_la_LDFLAGS variable is set to -shared to specify that the library should be built as a shared object.

About the option ```-version-info 0:0:0```, we will make it clear after seeing the output of build process.

### Build with Libtool support

```
ncmv@localhost:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/02_jsoncpp_lib$ ls
AUTHORS  ChangeLog  configure.ac  include  Makefile.am  NEWS  README  src

ncmv@localhost:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/02_jsoncpp_lib$ autoreconf -i
aclocal: warning: couldn't open directory 'm4': No such file or directory
libtoolize: putting auxiliary files in '.'.
libtoolize: copying file './ltmain.sh'
libtoolize: putting macros in AC_CONFIG_MACRO_DIRS, 'm4'.
libtoolize: copying file 'm4/libtool.m4'
libtoolize: copying file 'm4/ltoptions.m4'
libtoolize: copying file 'm4/ltsugar.m4'
libtoolize: copying file 'm4/ltversion.m4'
libtoolize: copying file 'm4/lt~obsolete.m4'
configure.ac:6: installing './ar-lib'
configure.ac:6: installing './compile'
configure.ac:7: installing './config.guess'
configure.ac:7: installing './config.sub'
configure.ac:2: installing './install-sh'
configure.ac:2: installing './missing'
Makefile.am: installing './depcomp'

ncmv@localhost:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/02_jsoncpp_lib$ ./configure 
checking for a BSD-compatible install... /usr/bin/install -c
checking whether build environment is sane... yes
checking for a race-free mkdir -p... /usr/bin/mkdir -p
checking for gawk... gawk
checking whether make sets $(MAKE)... yes
checking whether make supports nested variables... yes
checking for g++... g++
checking whether the C++ compiler works... yes
checking for C++ compiler default output file name... a.out
checking for suffix of executables... 
checking whether we are cross compiling... no
checking for suffix of object files... o
checking whether the compiler supports GNU C++... yes
checking whether g++ accepts -g... yes
checking for g++ option to enable C++11 features... none needed
checking whether make supports the include directive... yes (GNU style)
checking dependency style of g++... gcc3
checking for gcc... gcc
checking whether the compiler supports GNU C... yes
checking whether gcc accepts -g... yes
checking for gcc option to enable C11 features... none needed
checking whether gcc understands -c and -o together... yes
checking dependency style of gcc... gcc3
checking for ar... ar
checking the archiver (ar) interface... ar
checking build system type... x86_64-pc-linux-gnu
checking host system type... x86_64-pc-linux-gnu
checking how to print strings... printf
checking for a sed that does not truncate output... /usr/bin/sed
checking for grep that handles long lines and -e... /usr/bin/grep
checking for egrep... /usr/bin/grep -E
checking for fgrep... /usr/bin/grep -F
checking for ld used by gcc... /usr/bin/ld
checking if the linker (/usr/bin/ld) is GNU ld... yes
checking for BSD- or MS-compatible name lister (nm)... /usr/bin/nm -B
checking the name lister (/usr/bin/nm -B) interface... BSD nm
checking whether ln -s works... yes
checking the maximum length of command line arguments... 1572864
checking how to convert x86_64-pc-linux-gnu file names to x86_64-pc-linux-gnu format... func_convert_file_noop
checking how to convert x86_64-pc-linux-gnu file names to toolchain format... func_convert_file_noop
checking for /usr/bin/ld option to reload object files... -r
checking for objdump... objdump
checking how to recognize dependent libraries... pass_all
checking for dlltool... no
checking how to associate runtime and link libraries... printf %s\n
checking for archiver @FILE support... @
checking for strip... strip
checking for ranlib... ranlib
checking command to parse /usr/bin/nm -B output from gcc object... ok
checking for sysroot... no
checking for a working dd... /usr/bin/dd
checking how to truncate binary pipes... /usr/bin/dd bs=4096 count=1
checking for mt... mt
checking if mt is a manifest tool... no
checking for stdio.h... yes
checking for stdlib.h... yes
checking for string.h... yes
checking for inttypes.h... yes
checking for stdint.h... yes
checking for strings.h... yes
checking for sys/stat.h... yes
checking for sys/types.h... yes
checking for unistd.h... yes
checking for dlfcn.h... yes
checking for objdir... .libs
checking if gcc supports -fno-rtti -fno-exceptions... no
checking for gcc option to produce PIC... -fPIC -DPIC
checking if gcc PIC flag -fPIC -DPIC works... yes
checking if gcc static flag -static works... yes
checking if gcc supports -c -o file.o... yes
checking if gcc supports -c -o file.o... (cached) yes
checking whether the gcc linker (/usr/bin/ld -m elf_x86_64) supports shared libraries... yes
checking whether -lc should be explicitly linked in... no
checking dynamic linker characteristics... GNU/Linux ld.so
checking how to hardcode library paths into programs... immediate
checking whether stripping libraries is possible... yes
checking if libtool supports shared libraries... yes
checking whether to build shared libraries... yes
checking whether to build static libraries... yes
checking how to run the C++ preprocessor... g++ -E
checking for ld used by g++... /usr/bin/ld -m elf_x86_64
checking if the linker (/usr/bin/ld -m elf_x86_64) is GNU ld... yes
checking whether the g++ linker (/usr/bin/ld -m elf_x86_64) supports shared libraries... yes
checking for g++ option to produce PIC... -fPIC -DPIC
checking if g++ PIC flag -fPIC -DPIC works... yes
checking if g++ static flag -static works... yes
checking if g++ supports -c -o file.o... yes
checking if g++ supports -c -o file.o... (cached) yes
checking whether the g++ linker (/usr/bin/ld -m elf_x86_64) supports shared libraries... yes
checking dynamic linker characteristics... (cached) GNU/Linux ld.so
checking how to hardcode library paths into programs... immediate
checking that generated files are newer than configure... done
configure: creating ./config.status
config.status: creating Makefile
config.status: executing depfiles commands
config.status: executing libtool commands

ncmv@localhost:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/02_jsoncpp_lib$ make
/bin/bash ./libtool  --tag=CXX   --mode=compile g++ -DPACKAGE_NAME=\"libjsoncpp\" -DPACKAGE_TARNAME=\"libjsoncpp\" -DPACKAGE_VERSION=\"1.0\" -DPACKAGE_STRING=\"libjsoncpp\ 1.0\" -DPACKAGE_BUGREPORT=\"nguyenchiemminhvu@gmail.com\" -DPACKAGE_URL=\"\" -DPACKAGE=\"libjsoncpp\" -DVERSION=\"1.0\" -DHAVE_STDIO_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_STRINGS_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_UNISTD_H=1 -DSTDC_HEADERS=1 -DHAVE_DLFCN_H=1 -DLT_OBJDIR=\".libs/\" -I.  -I./include -fPIC   -g -O2 -MT ./src/libjsoncpp_la-json_reader.lo -MD -MP -MF ./src/.deps/libjsoncpp_la-json_reader.Tpo -c -o ./src/libjsoncpp_la-json_reader.lo `test -f './src/json_reader.cpp' || echo './'`./src/json_reader.cpp
libtool: compile:  g++ -DPACKAGE_NAME=\"libjsoncpp\" -DPACKAGE_TARNAME=\"libjsoncpp\" -DPACKAGE_VERSION=\"1.0\" "-DPACKAGE_STRING=\"libjsoncpp 1.0\"" -DPACKAGE_BUGREPORT=\"nguyenchiemminhvu@gmail.com\" -DPACKAGE_URL=\"\" -DPACKAGE=\"libjsoncpp\" -DVERSION=\"1.0\" -DHAVE_STDIO_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_STRINGS_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_UNISTD_H=1 -DSTDC_HEADERS=1 -DHAVE_DLFCN_H=1 -DLT_OBJDIR=\".libs/\" -I. -I./include -fPIC -g -O2 -MT ./src/libjsoncpp_la-json_reader.lo -MD -MP -MF ./src/.deps/libjsoncpp_la-json_reader.Tpo -c ./src/json_reader.cpp  -fPIC -DPIC -o ./src/.libs/libjsoncpp_la-json_reader.o
libtool: compile:  g++ -DPACKAGE_NAME=\"libjsoncpp\" -DPACKAGE_TARNAME=\"libjsoncpp\" -DPACKAGE_VERSION=\"1.0\" "-DPACKAGE_STRING=\"libjsoncpp 1.0\"" -DPACKAGE_BUGREPORT=\"nguyenchiemminhvu@gmail.com\" -DPACKAGE_URL=\"\" -DPACKAGE=\"libjsoncpp\" -DVERSION=\"1.0\" -DHAVE_STDIO_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_STRINGS_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_UNISTD_H=1 -DSTDC_HEADERS=1 -DHAVE_DLFCN_H=1 -DLT_OBJDIR=\".libs/\" -I. -I./include -fPIC -g -O2 -MT ./src/libjsoncpp_la-json_reader.lo -MD -MP -MF ./src/.deps/libjsoncpp_la-json_reader.Tpo -c ./src/json_reader.cpp -o ./src/libjsoncpp_la-json_reader.o >/dev/null 2>&1
mv -f ./src/.deps/libjsoncpp_la-json_reader.Tpo ./src/.deps/libjsoncpp_la-json_reader.Plo
/bin/bash ./libtool  --tag=CXX   --mode=compile g++ -DPACKAGE_NAME=\"libjsoncpp\" -DPACKAGE_TARNAME=\"libjsoncpp\" -DPACKAGE_VERSION=\"1.0\" -DPACKAGE_STRING=\"libjsoncpp\ 1.0\" -DPACKAGE_BUGREPORT=\"nguyenchiemminhvu@gmail.com\" -DPACKAGE_URL=\"\" -DPACKAGE=\"libjsoncpp\" -DVERSION=\"1.0\" -DHAVE_STDIO_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_STRINGS_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_UNISTD_H=1 -DSTDC_HEADERS=1 -DHAVE_DLFCN_H=1 -DLT_OBJDIR=\".libs/\" -I.  -I./include -fPIC   -g -O2 -MT ./src/libjsoncpp_la-json_value.lo -MD -MP -MF ./src/.deps/libjsoncpp_la-json_value.Tpo -c -o ./src/libjsoncpp_la-json_value.lo `test -f './src/json_value.cpp' || echo './'`./src/json_value.cpp
libtool: compile:  g++ -DPACKAGE_NAME=\"libjsoncpp\" -DPACKAGE_TARNAME=\"libjsoncpp\" -DPACKAGE_VERSION=\"1.0\" "-DPACKAGE_STRING=\"libjsoncpp 1.0\"" -DPACKAGE_BUGREPORT=\"nguyenchiemminhvu@gmail.com\" -DPACKAGE_URL=\"\" -DPACKAGE=\"libjsoncpp\" -DVERSION=\"1.0\" -DHAVE_STDIO_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_STRINGS_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_UNISTD_H=1 -DSTDC_HEADERS=1 -DHAVE_DLFCN_H=1 -DLT_OBJDIR=\".libs/\" -I. -I./include -fPIC -g -O2 -MT ./src/libjsoncpp_la-json_value.lo -MD -MP -MF ./src/.deps/libjsoncpp_la-json_value.Tpo -c ./src/json_value.cpp  -fPIC -DPIC -o ./src/.libs/libjsoncpp_la-json_value.o
libtool: compile:  g++ -DPACKAGE_NAME=\"libjsoncpp\" -DPACKAGE_TARNAME=\"libjsoncpp\" -DPACKAGE_VERSION=\"1.0\" "-DPACKAGE_STRING=\"libjsoncpp 1.0\"" -DPACKAGE_BUGREPORT=\"nguyenchiemminhvu@gmail.com\" -DPACKAGE_URL=\"\" -DPACKAGE=\"libjsoncpp\" -DVERSION=\"1.0\" -DHAVE_STDIO_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_STRINGS_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_UNISTD_H=1 -DSTDC_HEADERS=1 -DHAVE_DLFCN_H=1 -DLT_OBJDIR=\".libs/\" -I. -I./include -fPIC -g -O2 -MT ./src/libjsoncpp_la-json_value.lo -MD -MP -MF ./src/.deps/libjsoncpp_la-json_value.Tpo -c ./src/json_value.cpp -o ./src/libjsoncpp_la-json_value.o >/dev/null 2>&1
mv -f ./src/.deps/libjsoncpp_la-json_value.Tpo ./src/.deps/libjsoncpp_la-json_value.Plo
/bin/bash ./libtool  --tag=CXX   --mode=compile g++ -DPACKAGE_NAME=\"libjsoncpp\" -DPACKAGE_TARNAME=\"libjsoncpp\" -DPACKAGE_VERSION=\"1.0\" -DPACKAGE_STRING=\"libjsoncpp\ 1.0\" -DPACKAGE_BUGREPORT=\"nguyenchiemminhvu@gmail.com\" -DPACKAGE_URL=\"\" -DPACKAGE=\"libjsoncpp\" -DVERSION=\"1.0\" -DHAVE_STDIO_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_STRINGS_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_UNISTD_H=1 -DSTDC_HEADERS=1 -DHAVE_DLFCN_H=1 -DLT_OBJDIR=\".libs/\" -I.  -I./include -fPIC   -g -O2 -MT ./src/libjsoncpp_la-json_writer.lo -MD -MP -MF ./src/.deps/libjsoncpp_la-json_writer.Tpo -c -o ./src/libjsoncpp_la-json_writer.lo `test -f './src/json_writer.cpp' || echo './'`./src/json_writer.cpp
libtool: compile:  g++ -DPACKAGE_NAME=\"libjsoncpp\" -DPACKAGE_TARNAME=\"libjsoncpp\" -DPACKAGE_VERSION=\"1.0\" "-DPACKAGE_STRING=\"libjsoncpp 1.0\"" -DPACKAGE_BUGREPORT=\"nguyenchiemminhvu@gmail.com\" -DPACKAGE_URL=\"\" -DPACKAGE=\"libjsoncpp\" -DVERSION=\"1.0\" -DHAVE_STDIO_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_STRINGS_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_UNISTD_H=1 -DSTDC_HEADERS=1 -DHAVE_DLFCN_H=1 -DLT_OBJDIR=\".libs/\" -I. -I./include -fPIC -g -O2 -MT ./src/libjsoncpp_la-json_writer.lo -MD -MP -MF ./src/.deps/libjsoncpp_la-json_writer.Tpo -c ./src/json_writer.cpp  -fPIC -DPIC -o ./src/.libs/libjsoncpp_la-json_writer.o
libtool: compile:  g++ -DPACKAGE_NAME=\"libjsoncpp\" -DPACKAGE_TARNAME=\"libjsoncpp\" -DPACKAGE_VERSION=\"1.0\" "-DPACKAGE_STRING=\"libjsoncpp 1.0\"" -DPACKAGE_BUGREPORT=\"nguyenchiemminhvu@gmail.com\" -DPACKAGE_URL=\"\" -DPACKAGE=\"libjsoncpp\" -DVERSION=\"1.0\" -DHAVE_STDIO_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_STRINGS_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_UNISTD_H=1 -DSTDC_HEADERS=1 -DHAVE_DLFCN_H=1 -DLT_OBJDIR=\".libs/\" -I. -I./include -fPIC -g -O2 -MT ./src/libjsoncpp_la-json_writer.lo -MD -MP -MF ./src/.deps/libjsoncpp_la-json_writer.Tpo -c ./src/json_writer.cpp -o ./src/libjsoncpp_la-json_writer.o >/dev/null 2>&1
mv -f ./src/.deps/libjsoncpp_la-json_writer.Tpo ./src/.deps/libjsoncpp_la-json_writer.Plo
/bin/bash ./libtool  --tag=CXX   --mode=link g++  -g -O2 -version-info 0:0:0 -shared  -o libjsoncpp.la -rpath /usr/local/lib ./src/libjsoncpp_la-json_reader.lo ./src/libjsoncpp_la-json_value.lo ./src/libjsoncpp_la-json_writer.lo  
libtool: link: g++  -fPIC -DPIC -shared -nostdlib /usr/lib/gcc/x86_64-linux-gnu/11/../../../x86_64-linux-gnu/crti.o /usr/lib/gcc/x86_64-linux-gnu/11/crtbeginS.o  ./src/.libs/libjsoncpp_la-json_reader.o ./src/.libs/libjsoncpp_la-json_value.o ./src/.libs/libjsoncpp_la-json_writer.o   -L/usr/lib/gcc/x86_64-linux-gnu/11 -L/usr/lib/gcc/x86_64-linux-gnu/11/../../../x86_64-linux-gnu -L/usr/lib/gcc/x86_64-linux-gnu/11/../../../../lib -L/lib/x86_64-linux-gnu -L/lib/../lib -L/usr/lib/x86_64-linux-gnu -L/usr/lib/../lib -L/usr/lib/gcc/x86_64-linux-gnu/11/../../.. -lstdc++ -lm -lc -lgcc_s /usr/lib/gcc/x86_64-linux-gnu/11/crtendS.o /usr/lib/gcc/x86_64-linux-gnu/11/../../../x86_64-linux-gnu/crtn.o  -g -O2   -Wl,-soname -Wl,libjsoncpp.so.0 -o .libs/libjsoncpp.so.0.0.0
libtool: link: (cd ".libs" && rm -f "libjsoncpp.so.0" && ln -s "libjsoncpp.so.0.0.0" "libjsoncpp.so.0")
libtool: link: (cd ".libs" && rm -f "libjsoncpp.so" && ln -s "libjsoncpp.so.0.0.0" "libjsoncpp.so")
libtool: link: ( cd ".libs" && rm -f "libjsoncpp.la" && ln -s "../libjsoncpp.la" "libjsoncpp.la" )

ncmv@localhost:~/study_workspace/CPP_Build_Toolchain/GNU_Autotools/SampleProjects/02_jsoncpp_lib$ ls .libs/
libjsoncpp.la  libjsoncpp.lai  libjsoncpp.so  libjsoncpp.so.0  libjsoncpp.so.0.0.0
```

The file named 'libjsoncpp.so.0.0.0' is created using the option '-version-info 0:0:0' in the LDFLAGS. This file represents the target version of the library.

To make things easier to manage, Libtool created a symbolic link called 'libjsoncpp.so' that points to 'libjsoncpp.so.0.0.0'. This way, we don't have to worry about version changes. For instance, if we have a newer version of libjsoncpp and use the option '-version-info 0:0:1', Libtool will automatically update the 'libjsoncpp.so' symbolic link to point to the newer version, which will be 'libjsoncpp.so.0.0.1'. This approach simplifies the usage of the library, as we can always refer to 'libjsoncpp.so' and not worry about the specific version number.

# Conclusion

In simple terms, GNU Autotools is a collection of tools that make it easier to build and install software projects. Autoconf helps us configure our project by detecting system features and dependencies. Automake generates the necessary Makefiles to build our project. Libtool helps manage shared libraries for better compatibility.

To truly understand Autotools, it's essential to practice and build a sample project on your own: [GNU_Autotools/SampleProjects/02_LocationService](https://github.com/nguyenchiemminhvu/CPP_Build_Toolchain/tree/master/GNU_Autotools/SampleProjects/02_LocationService)

I encourage you to take up the challenge and try building the sample project before seeking the solution: [configure.ac](https://github.com/nguyenchiemminhvu/CPP_Build_Toolchain/blob/master/GNU_Autotools/SampleProjects/03_LocationService/configure.ac) and [Makefile.am](https://github.com/nguyenchiemminhvu/CPP_Build_Toolchain/blob/master/GNU_Autotools/SampleProjects/03_LocationService/Makefile.am).

**References**

[https://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.72/autoconf.html](https://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.72/autoconf.html)

[https://www.gnu.org/savannah-checkouts/gnu/automake/manual/automake.html](https://www.gnu.org/savannah-checkouts/gnu/automake/manual/automake.html)

[https://www.gnu.org/savannah-checkouts/gnu/libtool/manual/libtool.html](https://www.gnu.org/savannah-checkouts/gnu/libtool/manual/libtool.html)

[https://www.gnu.org/software/automake/faq/autotools-faq.html](https://www.gnu.org/software/automake/faq/autotools-faq.html)

[https://opensource.com/article/19/7/introduction-gnu-autotools](https://opensource.com/article/19/7/introduction-gnu-autotools)

[https://www.star.bnl.gov/~liuzx/autobook.html](https://www.star.bnl.gov/~liuzx/autobook.html)

[http://freesoftwaremagazine.com/articles/brief_introduction_to_gnu_autotools/](http://freesoftwaremagazine.com/articles/brief_introduction_to_gnu_autotools/)
